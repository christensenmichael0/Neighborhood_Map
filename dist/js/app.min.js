"use strict";function initMap(){console.log("initializing map"),mapCanvas=$(".map-canvas")[0],center=new google.maps.LatLng(cityCenter[0],cityCenter[1]),map=GoogleMap(center,mapCanvas),infoWindow=new InfoBubble({map:map,content:"",shadowStyle:1,padding:0,backgroundColor:"#ffffe6",borderRadius:5,maxWidth:300,maxHeight:250,arrowSize:10,borderWidth:1,borderColor:"#000000",arrowPosition:25,arrowStyle:2})}function googleFail(){$(".distance-control").css("display","none"),$(".menu-main").append("<div class='load-fail'>Unable to load Google Maps API</div>")}function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}var meetupApiUrl="https://api.meetup.com/2/open_events?and_text=False&offset=0&format=json&lon=-71.0589&limited_events=False&photo-host=public&page=100&radius=30&category=9&lat=42.3601&status=upcoming&desc=False&sig_id=35254712&sig=7e6d98b3125f607299e60bca0ba88f3aa7d483e2",dateObj=new Date,presentTime=dateObj.getTime(),ONEDAY=864e5,cityCenter=[42.3601,-71.0589],map,mapCanvas,center,infoWindow;String.prototype.firstLetterUpperCase=function(){for(var a,b,c=this.split(" "),d=[],e=0;e<c.length;++e)a=c[e].charAt(0).toUpperCase(),b=c[e].slice(1),d.push(a+b);return d.join(" ")},String.prototype.contains=function(a){return this.indexOf(a)!==-1},Array.prototype.contains=function(a){return this.indexOf(a)>-1};var VenueLocation=function(a,b){var c=this;c.lat=a.lat,c.lon=a.lon,c.location=ko.computed(function(){return isNumeric(c.lat)&&isNumeric(c.lon)&&0!==c.lat&&0!==c.lon?new google.maps.LatLng(c.lat,c.lon):null}),c.id=a.id,c.name=a.name.firstLetterUpperCase(),c.meetups=ko.observableArray([]),c.marker=function(a){var c;return a.location()&&(c=new google.maps.Marker({position:a.location(),map:b})),c}(c),c.formattedMeetupList=function(){var a='<ol class="info-window-list">';return c.meetups().forEach(function(b){a+='<li class="info-window-list-items"><div class="primary-info"><b>Group:</b> '+b.group+'</div><div class="primary-info"><b>Event:</b> <a href="'+b.url+'">'+b.name+'</a></div><div class="primary-info"><b>Date:</b> '+b.date+'</div><div class="primary-info"><b>Attending:</b> '+b.attending+'</div><div class="primary-info"><b>Description:</b></div><div class="meetup-descrip">'+b.description+"</div></li>"}),a+="</ol>",'<div class="info-window-content"><span class="info-window-header">'+c.name+"</span>"+a+"</div>"}},Meetup=function(a){var b=this;b.venueObject=a.venue,b.id=a.id,b.name=a.name.toUpperCase(),b.venueName=a.venue.name,b.group=a.group.name,b.attending=a.yes_rsvp_count,b.description=a.description,b.distance=a.distance,b.url=a.event_url,null==b.description&&(b.description="None Available"),b.milliseconds=a.time,b.date=new Date(b.milliseconds),b.numDayDif=(a.time-presentTime)/ONEDAY,b.numWeekDif=Math.floor((a.time-presentTime)/(7*ONEDAY)),b.date=b.date.toLocaleDateString()},GoogleMap=function(a,b){var c={zoom:9,center:a,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"usroadatlas"]},mapTypeControl:!1,panControl:!1,streetViewControl:!0,zoomControl:!0},d=new google.maps.Map(b,c),e={},f=new google.maps.StyledMapType(roadAtlasStyles,e);return d.mapTypes.set("usroadatlas",f),d.setMapTypeId("usroadatlas"),d},ViewModel=function(){function a(a){$.ajax({type:"GET",url:a,timeout:5e3,contentType:"application/json",dataType:"jsonp",cache:!1}).done(function(a){f.data=a.results,f.data.forEach(function(a){a.hasOwnProperty("venue")&&f.meetupList.push(new Meetup(a))})}).fail(function(a,b,c){$(".menu-main").append("<div class='load-fail'>Unable to load Meetup data</div>")})}function b(){g=new google.maps.LatLngBounds,f.venueLocList().forEach(function(a){g.extend(a.marker.getPosition())}),"undefined"!=typeof map&&map.fitBounds(g)}function c(a){var b=!1;if(f.venueLocList().length>0){var c=f.venueLocList().map(function(a){return a.id.toString()});b=c.contains(a.toString())}return b}function d(a){var b=f.venueLocList().map(function(b){return b.id.toString()===a.toString()}),c=b.indexOf(!0);return c!==-1?f.venueLocList()[c]:null}function e(){f.meetupList().forEach(function(a){if(a.distance<f.radius()&&a.numWeekDif<f.numWeeks()&&a.venueName.toLowerCase().contains(f.query().toLowerCase())){var b,e=a.venueObject.id;c(e)?(b=d(e),b.meetups.push(a)):(b=new VenueLocation(a.venueObject,map),b.location()&&(f.venueLocList.push(b),b.meetups.push(a),google.maps.event.addListener(b.marker,"click",function(){f.selectVenueLoc(b)}),google.maps.event.addListener(map,"click",function(){infoWindow.close()})))}})}var f=this;f.closeMenu=ko.observable(!1),f.clickToggle=function(){f.closeMenu(!f.closeMenu())},f.numWeeks=ko.observable(2),f.radius=ko.observable(5),f.meetupList=ko.observableArray([]),f.venueLocList=ko.observableArray([]),f.numGroups=ko.observable(0),f.numMeetups=ko.observableArray([]),f.query=ko.observable(""),f.filteredList=ko.computed(function(){return f.venueLocList().forEach(function(a){a.marker.setMap(null)}),f.venueLocList([]),e(),f.venueLocList().forEach(function(a){a.marker.setMap(map)}),"undefined"!=typeof google&&"undefined"!=typeof google.maps&&b(),f.numGroups(f.venueLocList().length),f.venueLocList()}),f.selectVenueLoc=function(a){infoWindow.setContent(a.formattedMeetupList()),infoWindow.open(map,a.marker),map.panTo(a.marker.position),a.marker.setAnimation(google.maps.Animation.BOUNCE),f.venueLocList().forEach(function(b){a!=b&&b.marker.setAnimation(null)})},f.data=[],a(meetupApiUrl);var g};ko.bindingHandlers.slider={init:function(a,b,c,d,e){var f=c().sliderOptions||{};$(a).slider(f),ko.utils.registerEventHandler(a,"slidechange",function(a,c){var d=b();d(c.value)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).slider("destroy")}),ko.utils.registerEventHandler(a,"slide",function(a,c){var d=b();d(c.value)})},update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0),$(a).slider("option",c().sliderOptions),$(a).slider("value",f)}},ko.bindingHandlers.slider2={init:function(a,b,c,d,e){ko.utils.registerEventHandler(a,"change",function(c){var d=b(),e=$(a).roundSlider("option","value");d(e)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).roundSlider("destroy")})},update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0),$(a).roundSlider("value",f)}};var slideDistance,slideDistanceSmall;ko.bindingHandlers.shiftVisible={update:function(a,b){var c=b();window.innerWidth>700?(slideDistance=$(".menu-main").outerWidth(),ko.unwrap(c)?$(a).animate({left:"-"+slideDistance+"px"},1e3,function(){$(".menu-toggle").html('<span class="fontawesome-chevron-right"></span>')}):$(".combined-menu-toggle").animate({left:"0px"},1e3,function(){$(".menu-toggle").html('<span class="fontawesome-chevron-left"></span>')})):(slideDistanceSmall=$(".menu-main").outerHeight(),ko.unwrap(c)?$(a).animate({top:"-"+slideDistanceSmall+"px"},1e3,function(){$(".menu-toggle-smallscreen").html('<span class="fontawesome-chevron-down"></span>')}):$(".combined-menu-toggle").animate({top:"0px"},1e3,function(){$(".menu-toggle-smallscreen").html('<span class="fontawesome-chevron-up"></span>')}))}},ko.applyBindings(new ViewModel);