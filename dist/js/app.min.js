"use strict";function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}var meetupApiUrl="https://api.meetup.com/2/open_events?and_text=False&offset=0&format=json&lon=-71.0589&limited_events=False&photo-host=public&page=100&radius=30&category=9&lat=42.3601&status=upcoming&desc=False&sig_id=35254712&sig=7e6d98b3125f607299e60bca0ba88f3aa7d483e2",dateObj=new Date,presentTime=dateObj.getTime(),ONEDAY=864e5,cityCenter=[42.3601,-71.0589];String.prototype.firstLetterUpperCase=function(){for(var a,b,c=this.split(" "),d=[],e=0;e<c.length;++e)a=c[e].charAt(0).toUpperCase(),b=c[e].slice(1),d.push(a+b);return d.join(" ")},String.prototype.contains=function(a){return this.indexOf(a)!==-1},Array.prototype.contains=function(a){return this.indexOf(a)>-1};var VenueLocation=function(a,b){var c=this;c.lat=a.lat,c.lon=a.lon,c.location=ko.computed(function(){return isNumeric(c.lat)&&isNumeric(c.lon)&&0!==c.lat&&0!==c.lon?new google.maps.LatLng(c.lat,c.lon):null}),c.id=a.id,c.name=a.name.firstLetterUpperCase(),c.meetups=ko.observableArray([]),c.marker=function(a){var c;return a.location()&&(c=new google.maps.Marker({position:a.location(),map:b})),c}(c),c.formattedMeetupList=function(){var a='<ol class="info-window-list">';return c.meetups().forEach(function(b){a+='<li class="info-window-list-items"><div class="primary-info"><b>Group:</b> '+b.group+'</div><div class="primary-info"><b>Event:</b> <a href="'+b.url+'">'+b.name+'</a></div><div class="primary-info"><b>Date:</b> '+b.date+'</div><div class="primary-info"><b>Attending:</b> '+b.attending+'</div><div class="primary-info"><b>Description:</b></div><div class="meetup-descrip">'+b.description+"</div></li>"}),a+="</ol>",'<div class="info-window-content"><span class="info-window-header">'+c.name+"</span>"+a+"</div>"}},Meetup=function(a){var b=this;b.venueObject=a.venue,b.id=a.id,b.name=a.name.toUpperCase(),b.venueName=a.venue.name,b.group=a.group.name,b.attending=a.yes_rsvp_count,b.description=a.description,b.distance=a.distance,b.url=a.event_url,null==b.description&&(b.description="None Available"),b.milliseconds=a.time,b.date=new Date(b.milliseconds),b.numDayDif=(a.time-presentTime)/ONEDAY,b.numWeekDif=Math.floor((a.time-presentTime)/(7*ONEDAY)),b.date=b.date.toLocaleDateString()},GoogleMap=function(a,b){var c=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#80ff80"},{visibility:"on"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#b0b0ff"},{visibility:"on"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#83eafc"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#83eafc"},{visibility:"on"},{weight:2}]}],d={zoom:9,center:a,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"usroadatlas"]},mapTypeControl:!1,panControl:!1,streetViewControl:!0,zoomControl:!0},e=new google.maps.Map(b,d),f={},g=new google.maps.StyledMapType(c,f);return e.mapTypes.set("usroadatlas",g),e.setMapTypeId("usroadatlas"),e},ViewModel=function(){function a(){$(".search-summary").text("Unable to load Google Maps API"),$(".word-weeks").css("display","none"),$(".meetup-info").css("display","none"),$(".distance-control").css("display","none")}function b(){i=GoogleMap(k,j),c(meetupApiUrl)}function c(a){$.ajax({type:"GET",url:a,timeout:1e4,contentType:"application/json",dataType:"jsonp",cache:!1}).done(function(a){h.data=a.results,h.data.forEach(function(a){a.hasOwnProperty("venue")&&h.meetupList.push(new Meetup(a))})}).fail(function(a,b,c){})}function d(){var a=new google.maps.LatLngBounds;h.venueLocList().forEach(function(b){a.extend(b.marker.getPosition())}),"undefined"!=typeof i&&i.fitBounds(a)}function e(a){var b=!1;if(h.venueLocList().length>0){var c=h.venueLocList().map(function(a){return a.id.toString()});b=c.contains(a.toString())}return b}function f(a){var b=h.venueLocList().map(function(b){return b.id.toString()===a.toString()}),c=b.indexOf(!0);return c!==-1?h.venueLocList()[c]:null}function g(){h.meetupList().forEach(function(a){if(a.distance<h.radius()&&a.numWeekDif<h.numWeeks()&&a.venueName.toLowerCase().contains(h.query().toLowerCase())){var b,c=a.venueObject.id;e(c)?(b=f(c),b.meetups.push(a)):(b=new VenueLocation(a.venueObject,i),b.location()&&(h.venueLocList.push(b),b.meetups.push(a),google.maps.event.addListener(b.marker,"click",function(){h.selectVenueLoc(b)}),google.maps.event.addListener(i,"click",function(){l.close()})))}})}var h=this;h.numWeeks=ko.observable(2),h.radius=ko.observable(5),setTimeout(function(){try{"object"==typeof google&&"object"==typeof google.maps||a()}catch(b){a()}},5e3);var i,j=$(".map-canvas")[0],k=new google.maps.LatLng(cityCenter[0],cityCenter[1]),l=new InfoBubble({map:i,content:"",shadowStyle:1,padding:0,backgroundColor:"#ffffe6",borderRadius:5,maxWidth:300,maxHeight:250,arrowSize:10,borderWidth:1,borderColor:"#000000",arrowPosition:25,arrowStyle:2});h.meetupList=ko.observableArray([]),h.venueLocList=ko.observableArray([]),h.numGroups=ko.observable(0),h.numMeetups=ko.observableArray([]),h.query=ko.observable(""),h.filteredList=ko.computed(function(){return h.venueLocList().forEach(function(a){a.marker.setMap(null)}),h.venueLocList([]),g(),h.venueLocList().forEach(function(a){a.marker.setMap(i)}),d(),h.numGroups(h.venueLocList().length),h.venueLocList()}),h.selectVenueLoc=function(a){l.setContent(a.formattedMeetupList()),l.open(i,a.marker),i.panTo(a.marker.position),a.marker.setAnimation(google.maps.Animation.BOUNCE),h.venueLocList().forEach(function(b){a!=b&&b.marker.setAnimation(null)})},h.data=[],google.maps.event.addDomListener(window,"load",b)};ko.bindingHandlers.slider={init:function(a,b,c,d,e){var f=c().sliderOptions||{};$(a).slider(f),ko.utils.registerEventHandler(a,"slidechange",function(a,c){var d=b();d(c.value)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).slider("destroy")}),ko.utils.registerEventHandler(a,"slide",function(a,c){var d=b();d(c.value)})},update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0),$(a).slider("option",c().sliderOptions),$(a).slider("value",f)}},ko.bindingHandlers.slider2={init:function(a,b,c,d,e){ko.utils.registerEventHandler(a,"change",function(c){var d=b(),e=$(a).roundSlider("option","value");d(e)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).roundSlider("destroy")})},update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0),$(a).roundSlider("value",f)}},ko.applyBindings(new ViewModel);