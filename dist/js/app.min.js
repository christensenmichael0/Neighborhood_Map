function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}var meetupApiUrl="https://api.meetup.com/2/open_events?and_text=False&offset=0&format=json&lon=-71.0589&limited_events=False&photo-host=public&page=100&radius=30&category=9&lat=42.3601&status=upcoming&desc=False&sig_id=35254712&sig=7e6d98b3125f607299e60bca0ba88f3aa7d483e2",dateObj=new Date,presentTime=dateObj.getTime(),oneDay=864e5,cityCenter=[42.3601,-71.0589];String.prototype.firstLetterUpperCase=function(){for(var a,b,c=this.split(" "),d=[],e=0;e<c.length;++e)a=c[e].charAt(0).toUpperCase(),b=c[e].slice(1),d.push(a+b);return d.join(" ")},String.prototype.contains=function(a){return this.indexOf(a)!==-1},Array.prototype.contains=function(a){return this.indexOf(a)>-1};var VenueLocation=function(a,b){var c=this;c.lat=a.lat,c.lon=a.lon,c.location=ko.computed(function(){return isNumeric(c.lat)&&isNumeric(c.lon)?new google.maps.LatLng(c.lat,c.lon):null}),c.id=a.id,c.name=ko.observable(a.name.firstLetterUpperCase()),c.meetups=ko.observableArray([]),c.marker=function(a){var c;return a.location()&&(c=new google.maps.Marker({position:a.location(),map:b})),c}(c),c.formattedMeetupList=function(){var a='<ol class="info-window-list">';return c.meetups().forEach(function(b){a+='<li class="info-window-list-items"><div class="primary-info"><b>Group:</b> '+b.group()+'</div><div class="primary-info"><b>Event:</b> <a href="'+b.url()+'">'+b.name()+'</a></div><div class="primary-info"><b>Date:</b> '+b.date()+'</div><div class="primary-info"><b>Attending:</b> '+b.attending()+'</div><div class="primary-info"><b>Description:</b></div><div class="meetup-descrip">'+b.description()+"</div></li>"}),a+="</ol>",'<div class="info-window-content"><span class="info-window-header">'+c.name()+"</span>"+a+"</div>"}},Meetup=function(a){var b=this;b.venueObject=a.venue,b.id=ko.observable(a.id),b.name=ko.observable(a.name.toUpperCase()),b.venueName=ko.observable(a.venue.name),b.group=ko.observable(a.group.name),b.attending=ko.observable(a.yes_rsvp_count),b.description=ko.observable(a.description),b.distance=ko.observable(a.distance),b.url=ko.observable(a.event_url),null===b.description()&&(b.description=ko.observable("None Available")),b.milliseconds=a.time,b.date=new Date(b.milliseconds),b.numDayDif=(a.time-presentTime)/oneDay,b.numWeekDif=Math.floor((a.time-presentTime)/(7*oneDay)),b.date=ko.computed(function(){return b.date.toLocaleDateString()})},GoogleMap=function(a,b){var c=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#80ff80"},{visibility:"on"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#b0b0ff"},{visibility:"on"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#83eafc"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#83eafc"},{visibility:"on"},{weight:2}]}],d={zoom:9,center:a,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"usroadatlas"]},mapTypeControl:!1,panControl:!1,streetViewControl:!0,zoomControl:!0};map=new google.maps.Map(b,d);var e={},f=new google.maps.StyledMapType(c,e);return map.mapTypes.set("usroadatlas",f),map.setMapTypeId("usroadatlas"),map},ViewModel=function(){function a(){g=GoogleMap(i,h),b(meetupApiUrl)}function b(a){$.ajax({type:"GET",url:a,timeout:1e4,contentType:"application/json",dataType:"jsonp",cache:!1}).done(function(a){f.data=a.results,f.data.forEach(function(a){a.hasOwnProperty("venue")&&f.meetupList.push(new Meetup(a))})}).fail(function(a,b,c){$("#search-summary").text("Unable to load Meetup data...")})}function c(a){var b=!1;if(f.venueLocList().length>0){var c=f.venueLocList().map(function(a){return a.id.toString()});b=c.contains(a.toString())}return b}function d(a){var b=f.venueLocList().map(function(b){return b.id.toString()===a.toString()}),c=b.indexOf(!0);return c!==-1?f.venueLocList()[c]:null}function e(){f.meetupList().forEach(function(a){if(a.distance()<f.radius()&&a.numWeekDif<f.numWeeks()&&a.venueName().toLowerCase().contains(f.query().toLowerCase())){var b,e=a.venueObject.id;c(e)?(b=d(e),b.meetups.push(a)):(b=new VenueLocation(a.venueObject,g),b.location()&&(f.venueLocList.push(b),b.meetups.push(a),google.maps.event.addListener(b.marker,"click",function(){f.selectVenueLoc(b)}),google.maps.event.addListener(g,"click",function(){j.close()})))}})}var f=this;f.numWeeks=ko.observable(2),f.radius=ko.observable(5);var g,h=$("#map-canvas")[0],i=new google.maps.LatLng(cityCenter[0],cityCenter[1]);"object"==typeof google&&"object"==typeof google.maps||$("#search-summary").text("Unable to load Google Maps API");var j=new InfoBubble({map:g,content:"",shadowStyle:1,padding:0,backgroundColor:"#ffffe6",borderRadius:5,maxWidth:300,maxHeight:250,arrowSize:10,borderWidth:1,borderColor:"#000000",arrowPosition:25,arrowStyle:2});f.meetupList=ko.observableArray([]),f.venueLocList=ko.observableArray([]),f.numGroups=ko.observable(0),f.numMeetups=ko.observableArray([]),f.query=ko.observable(""),f.filteredList=ko.computed(function(){return f.venueLocList().forEach(function(a){a.marker.setMap(null)}),f.venueLocList([]),e(),f.venueLocList().forEach(function(a){a.marker.setMap(g)}),f.numGroups(f.venueLocList().length),f.venueLocList()}),f.selectVenueLoc=function(a){j.setContent(a.formattedMeetupList()),j.open(g,a.marker),g.panTo(a.marker.position),a.marker.setAnimation(google.maps.Animation.BOUNCE),f.venueLocList().forEach(function(b){a!=b&&b.marker.setAnimation(null)})},f.data=[],google.maps.event.addDomListener(window,"load",a)};ko.bindingHandlers.slider={init:function(a,b,c,d,e){var f=c().sliderOptions||{};$(a).slider(f),ko.utils.registerEventHandler(a,"slidechange",function(a,c){var d=b();d(c.value)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).slider("destroy")}),ko.utils.registerEventHandler(a,"slide",function(a,c){var d=b();d(c.value)})},update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0),$(a).slider("option",c().sliderOptions),$(a).slider("value",f)}},ko.bindingHandlers.slider2={init:function(a,b,c,d,e){ko.utils.registerEventHandler(a,"change",function(c){var d=b(),e=$(a).roundSlider("option","value");d(e)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).roundSlider("destroy")})},update:function(a,b,c,d,e){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0),$(a).roundSlider("value",f)}},ko.applyBindings(new ViewModel);